# Paylink Payment Gateway Integration (Laravel) ๐ณ

ูุฐุง ุงููุณุชูุฏุน ููุถุญ **ุทุฑููุฉ ุฑุจุท ุจูุงุจุฉ ุงูุฏูุน Paylink** ูู ุฅุทุงุฑ ุนูู Laravel ุจุทุฑููุฉ ููุธูุฉุ ุจุณูุทุฉุ ููุงุจูุฉ ููุชูุณุนุฉ ูุงุญููุง.

> **โ๏ธ ุชูุจูู:** ูุฐุง ุงูุนูู ูุฎุตุต ููุชุฌุฑุจุฉ ูุงูุชุนููู ูููุณ ุชุทุจูููุง ููุงุฆููุง ููุฅูุชุงุฌ (Production).

---

## ๐ ุงููุฏู ูู ูุฐุง ุงููุดุฑูุน
* ุดุฑุญ ููููุฉ ุจูุงุจุฉ ุฏูุน ุจุทุฑููุฉ ุตุญูุญุฉ (Best Practices).
* ูุตู ููุทู ุงูุฏูุน ุนู ุงูููุชุฑููุฑ (Separation of Concerns).
* ุชุฌููุฒ ุฃุณุงุณ ูุงุจู ูุฅุถุงูุฉ ุจูุงุจุงุช ุฏูุน ุฃุฎุฑู ูุณุชูุจูุงู.
* ุชุณููู ููู ุชุฏูู ุงูุฏูุน (Payment Flow) ูุฃู ูุทููุฑ.

---

## ๐ง ุงูููุฑุฉ ุงูุนุงูุฉ (Architecture)
ุงูุชุตููู ูุจูู ุนูู ูุจุฏุฃ:  
**Controller** โ **Gateway Service** โ **External API**

* **Controller:** ูุณุคูู ููุท ุนู ุงุณุชูุจุงู ุงูุทูุจุ ุชุฌููุฒ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉุ ูุฅุฑุฌุงุน ุงููุชูุฌุฉ.
* **Gateway Service:** ูุณุคูู ุนู ุงูุงุชุตุงู ูุน Paylink APIุ ุฅูุดุงุก ุงููุงุชูุฑุฉุ ูุนุงูุฌุฉ ุงูู Webhookุ ูุชูุญูุฏ ุดูู ุงูุงุณุชุฌุงุจุฉ.

---

## ๐๏ธ ููููุฉ ุงููููุงุช (Structure)

### 1๏ธโฃ ุงููุณุงุฑุงุช `routes/web.php`
* `checkout`: ูุจุฏุฃ ุนูููุฉ ุงูุฏูุน ููุฑุณู ุงูุทูุจ ูุจูุงุจุฉ Paylink.
* `webhook`: ูุณุชูุจู ุฑุฏ Paylink ุงูุชููุงุฆู ุจุนุฏ ุฅุชูุงู ุฃู ูุดู ุงูุฏูุน.

### 2๏ธโฃ ุงููุชุญูู `PaymentTestController.php`
**ุงููุณุงุฑ:** `app/Http/Controllers/Payment/PaymentTestController.php`  
ููุชุตุฑ ุฏูุฑู ุนูู ุงุณุชุฏุนุงุก ุงูุฎุฏูุฉ (Service) ูุชูุฑูุฑ ุงูุจูุงูุงุชุ ููุง ูุญุชูู ุนูู ุฃู ููุทู ุฎุงุต ุจู API.

### 3๏ธโฃ ุงูุฎุฏูุฉ `PaylinkGateway.php`
**ุงููุณุงุฑ:** `app/Services/Billing/Gateways/PaylinkGateway.php`  
**ุงููุณุคูููุงุช:**
* ุงูุชูุซูู (Authenticate) ูุน API.
* ุฅูุดุงุก ุงููุงุชูุฑุฉ (Invoice).
* ูุนุงูุฌุฉ ุงูู Webhook ูุชูุญูุฏ ุงูุฑุฏ.

### 4๏ธโฃ ููู ุงูุฅุนุฏุงุฏุงุช `config/payments.php`
ูุณุชุฎุฏู ูุชูุธูู ุงูุฅุนุฏุงุฏุงุช ูููุน ุงุณุชุฎุฏุงู `env()` ูุจุงุดุฑุฉ ุฏุงุฎู ุงูููุฏุ ููุง ูุณูู ุงูุชุจุฏูู ุจูู ูุถุน ุงูุงุฎุชุจุงุฑ ูุงูุฅูุชุงุฌ.

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ (Environment Variables)

ูู ุจุฅุถุงูุฉ ุงููุชุบูุฑุงุช ุงูุชุงููุฉ ูู ููู `.env`:

```env
PAYMENT_DEFAULT_GATEWAY=paylink
PAYMENT_TEST_MODE=true

PAYLINK_API_KEY=your_api_key_here
PAYLINK_SECRET_KEY=your_secret_key_here
PAYLINK_API_URL=[https://api.paylink.sa](https://api.paylink.sa)
PAYLINK_SANDBOX_URL=[https://sandbox.paylink.sa](https://sandbox.paylink.sa)
```

---
---

## ๐ ุชุฏูู ุงูุจูุงูุงุช ุงูุจุฑูุฌู (Sequence Flow)

ููุถุญ ุงููุฎุทุท ุงูุชุงูู ุฏูุฑุฉ ุญูุงุฉ ุงูุทูุจ ูููููุฉ ุงูุชูุงุนู ุจูู ุงูููููุงุช ุงููุฎุชููุฉ ุงูุชู ุชู ุจูุงุคูุง:

1. **User Request**: ูุจุฏุฃ ุงููุณุชุฎุฏู ุทูุจ ุงูุฏูุน ูู ุงููุชุตูุญ.
2. **Controller**: ูุณุชูุจู ุงูุทูุจุ ููููู ุจุฅูุดุงุก ุณุฌู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Status: Pending).
3. **Gateway Service**: ุชุฃุฎุฐ ุงูุจูุงูุงุชุ ุชุทูุจ ุงูุชูุซูู (Auth) ูู Paylinkุ ุซู ุชูุดุฆ ุงููุงุชูุฑุฉ ูุชูุฑุฌุน ุฑุงุจุท ุงูุฏูุน.
4. **Paylink API**: ุชุนุงูุฌ ุงูุฏูุน ูุน ุงูุจูู ูุชุฑุณู ุฅุดุนุงุฑุงู (Webhook) ููุธุงููุง.
5. **Webhook Logic**: ุงูููุชุฑููุฑ ูุณุชูู ุงูุฅุดุนุงุฑุ ููุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู (Completed).



---

## ๐๏ธ ุงููููุฒุงุช ุงูุชูููุฉ ูู ูุฐุง ุงูุฅุตุฏุงุฑ (Version 1.1)

* **Automatic Reference Generation**: ูุชู ุชูููุฏ ุฑูู ุงููุฑุฌุน `PAY-XXXX` ุชููุงุฆูุงู ุนุจุฑ `Model Boot Method`.
* **State Management**: ุฅุฏุงุฑุฉ ุญุงูุงุช ุงูุฏูุน (Pending, Completed, Failed) ุจุดูู ุขูู ุฏุงุฎู ุงูููุฏูู.
* **JSON Logging**: ุชุฎุฒูู ุงูุฑุฏ ุงููุงูู ูู ุจูุงุจุฉ ุงูุฏูุน ูู ุญูู `gateway_response` ูุชุณููู ุนูููุงุช ุงูุชุฏููู (Auditing).
* **Decoupled Design**: ุฅููุงููุฉ ุงุณุชุจุฏุงู Paylink ุจุฃู ุจูุงุจุฉ ุฃุฎุฑู ุฏูู ุชุบููุฑ ููุทู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

---
## ๐ ููู ุชุจุฏุฃ ูุน ูุฐุง ุงููุดุฑูุนุ

1. ูู ุจุนูู `Clone` ูููุณุชูุฏุน.
2. ูู ุจุชุดุบูู `composer install`.
3. ูู ุจุชููุฆุฉ ููู ุงูู `.env` ูุฅุถุงูุฉ ููุงุชูุญ Paylink.
4. ูู ุจุชุดุบูู ุงูููุฌุฑ `php artisan migrate` ูุฅูุดุงุก ุฌุฏูู ุงูู `payments`.
5. ูู ุจุฒูุงุฑุฉ ุงููุณุงุฑ `/payment/paylink/checkout` ูุจุฏุก ุงูุชุฌุฑุจุฉ.
---

### ๐ฉโ๐ป ุชุทููุฑ ูุฅุนุฏุงุฏ
## ุจูุงุณุทุฉ ุงููุจุฑูุฌุฉ: ุฎุชุงู ุญูุฏู ุงุฎููู

# ุตุฏูุฉ ุฌุงุฑูุฉ ุนู ุฑูุญ ูุงูุฏู ุงูุดููุฏ ุญูุฏู ุงุฎููู
 ุงูููู ุงุฑุญูู ูุชูุจูู ูู ุงูุดูุฏุงุก ูุงุฌุนู ูุณููู ุงููุฑุฏูุณ ุงูุฃุนูู ูู ุงูุฌูุฉ
